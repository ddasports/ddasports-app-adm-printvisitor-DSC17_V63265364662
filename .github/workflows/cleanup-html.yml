name: Cleanup HTML Files Daily

on:
  schedule:
    # Runs daily at midnight UTC
    - cron: "0 0 * * *"
  workflow_dispatch: # optional manual trigger

permissions:
  contents: write

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # full history (optional here, but good practice)

      - name: Delete all HTML files except exclusions
        run: |
          # Files to keep
          EXCLUDE=("place_holder.html" "index.html" "old/index.html")

          # Find all .html files recursively
          find . -type f -name "*.html" | while read file; do
            BASENAME=$(basename "$file")

            # Skip excluded files
            if [[ " ${EXCLUDE[@]} " =~ " ${BASENAME} " ]]; then
              continue
            fi

            echo "Deleting $file"
            git rm "$file"
          done

          # Commit deletions if any
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"
          git commit -m "chore: delete all HTML files except exclusions" || echo "No files to delete"
          git push
